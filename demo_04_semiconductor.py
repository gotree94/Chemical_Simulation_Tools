#!/usr/bin/env python3
"""
=============================================================
 ë°˜ë„ì²´/ì „ìì†Œì¬ ë°ëª¨ (Semiconductor & Electronic Materials Demo)
=============================================================
"""

import numpy as np
import warnings
warnings.filterwarnings('ignore')

print("=" * 65)
print(" ğŸ’ ë°˜ë„ì²´/ì „ìì†Œì¬ ë°ëª¨ â€” Semiconductor Materials Pipeline")
print("=" * 65)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1. ë°˜ë„ì²´ ì†Œì¬ ë°ì´í„°ë² ì´ìŠ¤
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("\nğŸ“¦ Step 1: ë°˜ë„ì²´ ì†Œì¬ ë°ì´í„°ë² ì´ìŠ¤")
print("-" * 50)

semiconductor_db = {
    "Si":      {"name": "ì‹¤ë¦¬ì½˜",         "bandgap": 1.12, "type": "ê°„ì ‘", "mu_e": 1400, "mu_h": 450,  "eps": 11.7, "a": 5.431, "crystal": "Diamond Cubic"},
    "Ge":      {"name": "ì €ë§ˆëŠ„",         "bandgap": 0.66, "type": "ê°„ì ‘", "mu_e": 3900, "mu_h": 1900, "eps": 16.0, "a": 5.658, "crystal": "Diamond Cubic"},
    "GaAs":    {"name": "ê°ˆë¥¨ë¹„ì†Œ",       "bandgap": 1.42, "type": "ì§ì ‘", "mu_e": 8500, "mu_h": 400,  "eps": 12.9, "a": 5.653, "crystal": "Zinc Blende"},
    "GaN":     {"name": "ê°ˆë¥¨ë‚˜ì´íŠ¸ë¼ì´ë“œ", "bandgap": 3.40, "type": "ì§ì ‘", "mu_e": 1000, "mu_h": 30,   "eps": 9.0,  "a": 3.189, "crystal": "Wurtzite"},
    "SiC_4H":  {"name": "íƒ„í™”ê·œì†Œ(4H)",   "bandgap": 3.26, "type": "ê°„ì ‘", "mu_e": 900,  "mu_h": 120,  "eps": 9.7,  "a": 3.073, "crystal": "Hexagonal"},
    "InP":     {"name": "ì¸ë“ì¸í™”ë¬¼",     "bandgap": 1.35, "type": "ì§ì ‘", "mu_e": 5400, "mu_h": 200,  "eps": 12.5, "a": 5.869, "crystal": "Zinc Blende"},
    "ZnO":     {"name": "ì‚°í™”ì•„ì—°",       "bandgap": 3.37, "type": "ì§ì ‘", "mu_e": 200,  "mu_h": 5,    "eps": 8.5,  "a": 3.250, "crystal": "Wurtzite"},
    "MoS2":    {"name": "ì´í™©í™”ëª°ë¦¬ë¸Œë´", "bandgap": 1.80, "type": "ì§ì ‘", "mu_e": 200,  "mu_h": 50,   "eps": 4.0,  "a": 3.160, "crystal": "Hexagonal"},
    "Ga2O3":   {"name": "ì‚°í™”ê°ˆë¥¨(Î²)",    "bandgap": 4.80, "type": "ì§ì ‘", "mu_e": 300,  "mu_h": 0,    "eps": 10.0, "a": 12.21, "crystal": "Monoclinic"},
    "Diamond": {"name": "ë‹¤ì´ì•„ëª¬ë“œ",     "bandgap": 5.47, "type": "ê°„ì ‘", "mu_e": 2200, "mu_h": 1600, "eps": 5.7,  "a": 3.567, "crystal": "Diamond Cubic"},
}

print(f"  {'ì†Œì¬':10s} {'ë°´ë“œê°­':>8s} {'íƒ€ì…':>6s} {'Î¼e(cmÂ²/Vs)':>12s} {'ìœ ì „ìœ¨':>8s} {'ê²°ì •':>15s}")
print(f"  {'â”€'*10} {'â”€'*8} {'â”€'*6} {'â”€'*12} {'â”€'*8} {'â”€'*15}")

for key, m in semiconductor_db.items():
    bg_bar = "â–ˆ" * int(m["bandgap"] * 3)
    print(f"  {key:10s} {m['bandgap']:>6.2f}eV {m['type']:>6s} {m['mu_e']:>10,d} {m['eps']:>7.1f} {m['crystal']:>15s} {bg_bar}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2. Pymatgen ê²°ì • êµ¬ì¡° ë¶„ì„
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("\n\nğŸ”¬ Step 2: Pymatgen ê²°ì • êµ¬ì¡° ìƒì„±/ë¶„ì„")
print("-" * 50)

from pymatgen.core import Structure, Lattice
from pymatgen.symmetry.analyzer import SpacegroupAnalyzer

# Si diamond cubic
print("\n  [2-1] Silicon â€” Diamond Cubic (Fd-3m)")
a = 5.431
lattice = Lattice.cubic(a)
si_species = ["Si"] * 8
si_coords = [
    [0.000, 0.000, 0.000], [0.500, 0.500, 0.000],
    [0.500, 0.000, 0.500], [0.000, 0.500, 0.500],
    [0.250, 0.250, 0.250], [0.750, 0.750, 0.250],
    [0.750, 0.250, 0.750], [0.250, 0.750, 0.750],
]
si_struct = Structure(lattice, si_species, si_coords)

sga = SpacegroupAnalyzer(si_struct)
print(f"  ê³µê°„êµ°: {sga.get_space_group_symbol()} (#{sga.get_space_group_number()})")
print(f"  ê²©ì ìƒìˆ˜: a = {a:.3f} Ã…")
print(f"  ë¶€í”¼: {si_struct.volume:.3f} Å³")
print(f"  ë°€ë„: {si_struct.density:.4f} g/cmÂ³ (ì‹¤í—˜ê°’: 2.329)")
print(f"  ì›ì ìˆ˜: {len(si_struct)}")

# GaAs zinc blende
print(f"\n  [2-2] GaAs â€” Zinc Blende (F-43m)")
a_gaas = 5.653
lattice_gaas = Lattice.cubic(a_gaas)
gaas_species = ["Ga", "Ga", "Ga", "Ga", "As", "As", "As", "As"]
gaas_coords = [
    [0.000, 0.000, 0.000], [0.500, 0.500, 0.000],
    [0.500, 0.000, 0.500], [0.000, 0.500, 0.500],
    [0.250, 0.250, 0.250], [0.750, 0.750, 0.250],
    [0.750, 0.250, 0.750], [0.250, 0.750, 0.750],
]
gaas_struct = Structure(lattice_gaas, gaas_species, gaas_coords)

sga_gaas = SpacegroupAnalyzer(gaas_struct)
print(f"  ê³µê°„êµ°: {sga_gaas.get_space_group_symbol()} (#{sga_gaas.get_space_group_number()})")
print(f"  ê²©ì ìƒìˆ˜: a = {a_gaas:.3f} Ã…")
print(f"  ë°€ë„: {gaas_struct.density:.4f} g/cmÂ³ (ì‹¤í—˜ê°’: 5.316)")

# ê²°í•© ê¸¸ì´ ë¶„ì„
print(f"\n  [2-3] ê²°í•© ê¸¸ì´ ë¶„ì„")
for name, struct in [("Si", si_struct), ("GaAs", gaas_struct)]:
    neighbors = struct.get_neighbors(struct[0], r=3.0)
    if neighbors:
        distances = [n.nn_distance for n in neighbors]
        print(f"  {name:6s}: ìµœê·¼ì ‘ ê±°ë¦¬ = {min(distances):.3f} Ã…, ë°°ìœ„ìˆ˜ = {len(distances)}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3. ASE ë²Œí¬ ë°˜ë„ì²´ ì—ë„ˆì§€
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("\n\nâš¡ Step 3: ASE ì›ì ì‹œë®¬ë ˆì´ì…˜")
print("-" * 50)

from ase.build import bulk
from ase.calculators.emt import EMT

print("\n  [3-1] FCC ê¸ˆì† ë²Œí¬ ì—ë„ˆì§€ (EMT)")
print(f"  {'ê¸ˆì†':>6s} {'ê²©ììƒìˆ˜':>10s} {'ì—ë„ˆì§€(eV/atom)':>16s} {'ë¶€í”¼(Å³/atom)':>14s}")
print(f"  {'â”€'*6} {'â”€'*10} {'â”€'*16} {'â”€'*14}")

for metal in ["Cu", "Ag", "Au", "Pt", "Pd", "Ni", "Al"]:
    atoms = bulk(metal, 'fcc')
    atoms.calc = EMT()
    e = atoms.get_potential_energy() / len(atoms)
    v = atoms.get_volume() / len(atoms)
    a_lat = atoms.cell.cellpar()[0]
    print(f"  {metal:>6s} {a_lat:>9.4f}Ã… {e:>14.6f} {v:>13.4f}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4. ë°´ë“œê°­ vs ê²©ììƒìˆ˜ ë§µ (Vegard's Law)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("\n\nğŸ“ˆ Step 4: ë°´ë“œê°­ vs ê²©ììƒìˆ˜ ë§µ")
print("-" * 50)

print(f"\n  ë°´ë“œê°­ (eV) â†‘")
print(f"  6.0 |")

# ì†Œì¬ ìœ„ì¹˜ ê³„ì‚° ë° í”Œë¡¯
materials_plot = [
    ("Diamond", 5.47, 3.567), ("Ga2O3", 4.80, 12.21),
    ("GaN", 3.40, 3.189), ("ZnO", 3.37, 3.250),
    ("SiC", 3.26, 3.073), ("MoS2", 1.80, 3.160),
    ("GaAs", 1.42, 5.653), ("InP", 1.35, 5.869),
    ("Si", 1.12, 5.431), ("Ge", 0.66, 5.658),
]

# ASCII ê²©ì ìƒìˆ˜ ë²”ìœ„ë¥¼ 3~13ìœ¼ë¡œ ë§µí•‘
for bg_level in np.arange(5.5, -0.5, -0.5):
    line = f"  {bg_level:3.1f} |"
    points = ""
    for name, bg, a_lat in materials_plot:
        if abs(bg - bg_level) < 0.3:
            col = int((a_lat - 2.5) / 10.0 * 50)
            points += " " * max(col - len(points), 1) + name[:4]
    print(line + points)

print(f"      +{'â”€'*55}")
print(f"        3    4    5    6    7    8    9   10   11   12")
print(f"                     ê²©ì ìƒìˆ˜ (Ã…) â†’")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 5. í•©ê¸ˆ ë°˜ë„ì²´ ë°´ë“œê°­ ì—”ì§€ë‹ˆì–´ë§
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("\n\nğŸ”€ Step 5: í•©ê¸ˆ ë°˜ë„ì²´ ë°´ë“œê°­ ì—”ì§€ë‹ˆì–´ë§")
print("-" * 50)

# AlxGa(1-x)As ë°´ë“œê°­ vs ì¡°ì„±
print("\n  [5-1] Al_x Ga_{1-x} As (AlGaAs)")
print("  Eg(x) = 1.424 + 1.247x  (x < 0.45, ì§ì ‘ê°­)")
print()
print(f"  {'x(Al)':>6s} {'Eg(eV)':>8s} {'ê°­íƒ€ì…':>8s} {'íŒŒì¥(nm)':>10s} {'ê·¸ë˜í”„':>25s}")
print(f"  {'â”€'*6} {'â”€'*8} {'â”€'*8} {'â”€'*10} {'â”€'*25}")

for x in np.arange(0, 1.05, 0.1):
    if x < 0.45:
        Eg = 1.424 + 1.247 * x
        gap = "ì§ì ‘"
    else:
        Eg = 1.900 + 0.125 * x + 0.143 * x * x
        gap = "ê°„ì ‘"
    wavelength = 1240 / Eg if Eg > 0 else float('inf')
    bar = "â–ˆ" * int(Eg * 8)
    print(f"  {x:>5.1f} {Eg:>7.3f} {gap:>8s} {wavelength:>8.0f}nm  {bar}")

# InxGa(1-x)N â€” LED í•µì‹¬ ì†Œì¬
print(f"\n  [5-2] In_x Ga_{{1-x}} N (InGaN) â€” LED í•µì‹¬ ì†Œì¬")
print("  Eg(x) = 3.40(1-x) + 0.70x - 1.43x(1-x)  (ë³´ì‰ íŒŒë¼ë¯¸í„°)")
print()
print(f"  {'x(In)':>6s} {'Eg(eV)':>8s} {'íŒŒì¥(nm)':>10s} {'ìƒ‰ìƒ':>8s} {'ìŠ¤í™íŠ¸ëŸ¼':>20s}")
print(f"  {'â”€'*6} {'â”€'*8} {'â”€'*10} {'â”€'*8} {'â”€'*20}")

for x in np.arange(0, 1.05, 0.1):
    Eg = 3.40 * (1 - x) + 0.70 * x - 1.43 * x * (1 - x)
    wl = 1240 / Eg if Eg > 0 else float('inf')
    
    if wl < 380: color = "UV"
    elif wl < 450: color = "ë³´ë¼"
    elif wl < 495: color = "íŒŒë‘"
    elif wl < 570: color = "ì´ˆë¡"
    elif wl < 590: color = "ë…¸ë‘"
    elif wl < 620: color = "ì£¼í™©"
    elif wl < 750: color = "ë¹¨ê°•"
    else: color = "ì ì™¸ì„ "
    
    bar_pos = int((wl - 300) / 700 * 40) if wl < 1000 else 39
    bar = " " * max(bar_pos, 0) + "â—"
    print(f"  {x:>5.1f} {Eg:>7.3f} {wl:>8.0f}nm {color:>8s}  {bar}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 6. ë„í•‘ ë†ë„ì™€ ì „ê¸°ì  íŠ¹ì„±
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("\n\nâš¡ Step 6: ë„í•‘ ë†ë„ì™€ ì „ê¸°ì  íŠ¹ì„± (Si)")
print("-" * 50)

q = 1.602e-19  # C
mu_e = 1400e-4  # mÂ²/VÂ·s (Si ì „ì)
mu_h = 450e-4   # mÂ²/VÂ·s (Si ì •ê³µ)
ni_si = 1.5e10  # /cmÂ³ (300K)

print(f"\n  [6-1] n-type Si ë„í•‘ì— ë”°ë¥¸ ì €í•­ë¥ ")
print(f"  {'Nd(cmâ»Â³)':>12s} {'n(cmâ»Â³)':>12s} {'p(cmâ»Â³)':>12s} {'Ï(Î©Â·cm)':>12s} {'Ïƒ(S/cm)':>12s}")
print(f"  {'â”€'*12} {'â”€'*12} {'â”€'*12} {'â”€'*12} {'â”€'*12}")

for nd_exp in range(12, 20):
    Nd = 10**nd_exp
    n = Nd  # ì™„ì „ ì´ì˜¨í™” ê°€ì •
    p = ni_si**2 / n
    sigma = q * (n * 1400 + p * 450)  # S/cm
    rho = 1 / sigma if sigma > 0 else float('inf')
    print(f"  {Nd:>10.2e} {n:>10.2e} {p:>10.2e} {rho:>10.4e} {sigma:>10.4e}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 7. PN ì ‘í•© ë‹¤ì´ì˜¤ë“œ íŠ¹ì„± ì‹œë®¬ë ˆì´ì…˜
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("\n\nğŸ”Œ Step 7: PN ì ‘í•© ë‹¤ì´ì˜¤ë“œ ì‹œë®¬ë ˆì´ì…˜")
print("-" * 50)

kT = 0.02585  # eV at 300K (kT/q in V)
Is = 1e-12    # ì—­í¬í™” ì „ë¥˜ (A)

print(f"\n  [7-1] ì´ìƒì  ë‹¤ì´ì˜¤ë“œ I-V íŠ¹ì„±")
print(f"  I = Is * (exp(V/nVt) - 1),  Is={Is:.0e}A, n=1, T=300K")
print()
print(f"  {'V(V)':>7s} {'I(A)':>12s} {'ì „ë¥˜':>30s}")
print(f"  {'â”€'*7} {'â”€'*12} {'â”€'*30}")

for V in np.arange(-0.5, 0.75, 0.05):
    I = Is * (np.exp(V / kT) - 1)
    I_clipped = max(min(I, 1), -Is * 10)
    if I > 1e-9:
        bar_len = min(int(np.log10(I / 1e-12) * 3), 40)
        bar = "â–ˆ" * max(bar_len, 0)
    elif I < 0:
        bar = "â—„"
    else:
        bar = "Â·"
    print(f"  {V:>6.2f}V {I:>12.4e} {bar}")

# 7-2: ë‚´ì¥ ì „ìœ„ (Built-in Potential)
print(f"\n  [7-2] PN ì ‘í•© ë‚´ì¥ ì „ìœ„")
print(f"  Vbi = (kT/q) * ln(Na*Nd/niÂ²)")

for Na_exp, Nd_exp in [(15, 15), (16, 16), (17, 17), (18, 15), (15, 18)]:
    Na = 10**Na_exp
    Nd = 10**Nd_exp
    Vbi = kT * np.log(Na * Nd / ni_si**2)
    W = np.sqrt(2 * 11.7 * 8.854e-14 * Vbi * (1/Na + 1/Nd) / q)  # ê³µí•ì¸µ í­ (cm)
    print(f"  Na={Na:.0e}, Nd={Nd:.0e} â†’ Vbi={Vbi:.4f}V, W={W*1e4:.2f}Î¼m")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 8. MOSFET ê¸°ë³¸ íŠ¹ì„±
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("\n\nğŸ“Š Step 8: MOSFET ê¸°ë³¸ íŠ¹ì„± ì‹œë®¬ë ˆì´ì…˜")
print("-" * 50)

# íŒŒë¼ë¯¸í„°
Vth = 0.5     # ë¬¸í„± ì „ì•• (V)
mu_n = 500    # ì±„ë„ ì´ë™ë„ (cmÂ²/VÂ·s)
Cox = 1e-7    # ì‚°í™”ë§‰ ì»¤íŒ¨ì‹œí„´ìŠ¤ (F/cmÂ²) - ì•½ 3.5nm SiO2
W = 10e-4     # ì±„ë„ í­ 10Î¼m
L = 0.1e-4    # ì±„ë„ ê¸¸ì´ 100nm
kn = mu_n * Cox * W / L  # A/VÂ²

print(f"  NMOS íŒŒë¼ë¯¸í„°:")
print(f"  Vth={Vth}V, Î¼n={mu_n}cmÂ²/Vs, toxâ‰ˆ3.5nm")
print(f"  W={W*1e4:.0f}Î¼m, L={L*1e4:.2f}Î¼m, W/L={W/L:.0f}")
print(f"  kn = Î¼nÂ·CoxÂ·W/L = {kn*1e3:.3f} mA/VÂ²")

# Id-Vgs ì „ë‹¬ íŠ¹ì„±
print(f"\n  [8-1] Id-Vgs ì „ë‹¬ íŠ¹ì„± (Vds=1.0V)")
print(f"  {'Vgs(V)':>8s} {'Id(mA)':>10s} {'ì˜ì—­':>8s} {'ì „ë¥˜':>25s}")
print(f"  {'â”€'*8} {'â”€'*10} {'â”€'*8} {'â”€'*25}")

Vds = 1.0
for Vgs in np.arange(0, 2.05, 0.1):
    if Vgs <= Vth:
        Id = 0
        region = "ì°¨ë‹¨"
    elif Vds <= (Vgs - Vth):
        Id = kn * ((Vgs - Vth) * Vds - 0.5 * Vds**2)
        region = "ì„ í˜•"
    else:
        Id = 0.5 * kn * (Vgs - Vth)**2
        region = "í¬í™”"
    
    bar = "â–ˆ" * int(Id * 1e3 / 0.15) if Id > 0 else ""
    print(f"  {Vgs:>7.1f}V {Id*1e3:>9.3f} {region:>8s}  {bar}")

# Id-Vds ì¶œë ¥ íŠ¹ì„±
print(f"\n  [8-2] Id-Vds ì¶œë ¥ íŠ¹ì„±")
print(f"  {'Vds':>6s}", end="")
for Vgs in [0.7, 1.0, 1.5, 2.0]:
    print(f" {'Vgs='+str(Vgs)+'V':>12s}", end="")
print()
print(f"  {'â”€'*6}", end="")
for _ in range(4):
    print(f" {'â”€'*12}", end="")
print()

for Vds in np.arange(0, 2.05, 0.2):
    print(f"  {Vds:>5.1f}V", end="")
    for Vgs in [0.7, 1.0, 1.5, 2.0]:
        if Vgs <= Vth:
            Id = 0
        elif Vds <= (Vgs - Vth):
            Id = kn * ((Vgs - Vth) * Vds - 0.5 * Vds**2)
        else:
            Id = 0.5 * kn * (Vgs - Vth)**2
        print(f" {Id*1e3:>10.3f}mA", end="")
    print()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 9. ì „ë ¥ ë°˜ë„ì²´ ì„±ëŠ¥ ì§€ìˆ˜ (Figure of Merit)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("\n\nâš¡ Step 9: ì „ë ¥ ë°˜ë„ì²´ ì„±ëŠ¥ ì§€ìˆ˜ (Figure of Merit)")
print("-" * 50)

print(f"\n  BFOM = ÎµÂ·Î¼Â·EcÂ³  (Baliga Figure of Merit)")
print(f"  Ec = ë°´ë“œê°­ ê¸°ë°˜ ì„ê³„ ì „ê³„ ì¶”ì •")

eps0 = 8.854e-12

power_semis = {
    "Si":      {"eps": 11.7, "mu": 1400, "Ec_MVcm": 0.3,  "Eg": 1.12},
    "GaAs":    {"eps": 12.9, "mu": 8500, "Ec_MVcm": 0.4,  "Eg": 1.42},
    "SiC_4H":  {"eps": 9.7,  "mu": 900,  "Ec_MVcm": 2.2,  "Eg": 3.26},
    "GaN":     {"eps": 9.0,  "mu": 1000, "Ec_MVcm": 3.3,  "Eg": 3.40},
    "Ga2O3":   {"eps": 10.0, "mu": 300,  "Ec_MVcm": 8.0,  "Eg": 4.80},
    "Diamond": {"eps": 5.7,  "mu": 2200, "Ec_MVcm": 10.0, "Eg": 5.47},
}

# Sië¥¼ ê¸°ì¤€(=1)ìœ¼ë¡œ ì •ê·œí™”
si_bfom = power_semis["Si"]["eps"] * power_semis["Si"]["mu"] * power_semis["Si"]["Ec_MVcm"]**3

print(f"\n  {'ì†Œì¬':10s} {'Îµ_r':>6s} {'Î¼(cmÂ²/Vs)':>10s} {'Ec(MV/cm)':>10s} {'BFOM/Si':>10s}")
print(f"  {'â”€'*10} {'â”€'*6} {'â”€'*10} {'â”€'*10} {'â”€'*10}")

fom_rankings = []
for name, p in power_semis.items():
    bfom = p["eps"] * p["mu"] * p["Ec_MVcm"]**3
    bfom_norm = bfom / si_bfom
    fom_rankings.append((name, bfom_norm, p))
    bar = "â–ˆ" * min(int(np.log10(max(bfom_norm, 1)) * 10), 40)
    print(f"  {name:10s} {p['eps']:>5.1f} {p['mu']:>8d} {p['Ec_MVcm']:>8.1f} {bfom_norm:>9.0f}x {bar}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 10. ì¢…í•© ë°˜ë„ì²´ ì†Œì¬ í‰ê°€
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("\n\nğŸ“‹ Step 10: ì¢…í•© ë°˜ë„ì²´ ì†Œì¬ í‰ê°€")
print("=" * 65)

print(f"\n  [ì‘ìš© ë¶„ì•¼ë³„ ìµœì  ì†Œì¬ ì¶”ì²œ]")
print()

apps = {
    "ë””ì§€í„¸ IC (ë¡œì§)": {"best": "Si", "reason": "ì„±ìˆ™ ê³µì •, ë¯¸ì„¸í™” ìµœì "},
    "ê³ ì†/RF IC": {"best": "GaAs", "reason": "ìµœê³  ì „ìì´ë™ë„ 8500cmÂ²/Vs"},
    "LED/ë ˆì´ì €": {"best": "GaN/InGaN", "reason": "ì§ì ‘ê°­, ê°€ì‹œê´‘ ì „ì²´ ì»¤ë²„"},
    "íƒœì–‘ì „ì§€": {"best": "GaAs", "reason": "ì§ì ‘ê°­ 1.42eV, ìµœê³  íš¨ìœ¨"},
    "ì „ë ¥ì†Œì(ì¤‘ì „ì••)": {"best": "SiC_4H", "reason": "ê³ ì„ê³„ì „ê³„, ê³ ì—´ì „ë„"},
    "ì „ë ¥ì†Œì(ê³ ì „ì••)": {"best": "Ga2O3", "reason": "BFOM ìµœê³ , ì´ˆê³ ì „ì••"},
    "ê·¹í•œí™˜ê²½": {"best": "Diamond", "reason": "ë°´ë“œê°­ 5.47eV, ì—´ì „ë„ ìµœê³ "},
    "2D ì†Œì/ì„¼ì„œ": {"best": "MoS2", "reason": "ë‹¨ì¸µ ì§ì ‘ê°­, ìœ ì—° ì†Œì"},
    "ê´‘í†µì‹ ": {"best": "InP", "reason": "1.3-1.55Î¼m ëŒ€ì—­ ìµœì "},
}

for app, info in apps.items():
    mat = semiconductor_db.get(info["best"].split("/")[0], {})
    bg = mat.get("bandgap", "?")
    print(f"  ğŸ¯ {app}")
    print(f"     ì¶”ì²œ: {info['best']} (Eg={bg}eV)")
    print(f"     ì´ìœ : {info['reason']}")
    print()

# ê¸°ìˆ  ì„±ìˆ™ë„ vs ì„±ëŠ¥ í¬í…ì…œ ë§¤íŠ¸ë¦­ìŠ¤
print(f"  [ê¸°ìˆ  ì„±ìˆ™ë„ vs ì„±ëŠ¥ í¬í…ì…œ]")
print()
print(f"  ì„±ëŠ¥ â†‘")
print(f"  ë†’ìŒ â”‚ Ga2O3    Diamond")
print(f"       â”‚    GaN")
print(f"       â”‚ SiC")
print(f"  ì¤‘ê°„ â”‚       GaAs   InP")
print(f"       â”‚ MoS2")
print(f"  ë‚®ìŒ â”‚          Si    Ge")
print(f"       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ê¸°ìˆ  ì„±ìˆ™ë„")
print(f"         ì´ˆê¸°    ì„±ì¥    ì„±ìˆ™")

print("\n" + "=" * 65)
print(" ğŸ’ ë°˜ë„ì²´/ì „ìì†Œì¬ ë°ëª¨ ì™„ë£Œ!")
print("=" * 65)
